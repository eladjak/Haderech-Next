#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 בודק את הקוד לפני push..."

# בדיקת טיפוסים
echo "📝 בודק טיפוסים..."
pnpm run type-check || {
  echo "❌ בדיקת טיפוסים נכשלה. אנא תקן את השגיאות לפני push."
  exit 1
}

# בדיקת לינטינג מחמירה
echo "🔍 בודק לינטינג מחמיר..."
pnpm run lint:strict || {
  echo "❌ בדיקת לינטינג מחמירה נכשלה. אנא תקן את השגיאות לפני push."
  exit 1
}

# בדיקת פורמט
echo "✨ בודק פורמט..."
pnpm run format:check || {
  echo "❌ בדיקת פורמט נכשלה. אנא הרץ 'pnpm run format' לתיקון."
  exit 1
}

# בדיקת בנייה
echo "🏗 בודק בנייה..."
pnpm run build || {
  echo "❌ בדיקת בנייה נכשלה. אנא תקן את השגיאות לפני push."
  exit 1
}

# בדיקת טסטים עם כיסוי קוד
echo "🧪 מריץ טסטים עם בדיקת כיסוי..."
pnpm run test:coverage || {
  echo "❌ הטסטים נכשלו או שכיסוי הקוד נמוך מהמינימום הנדרש."
  exit 1
}

# וולידציה סופית
echo "🔎 מבצע וולידציה סופית..."
pnpm run validate || {
  echo "❌ הוולידציה נכשלה. אנא תקן את כל השגיאות לפני הדחיפה."
  exit 1
}

echo "✅ כל הבדיקות עברו בהצלחה! 🎉" 