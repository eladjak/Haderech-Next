#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run type checking
pnpm type-check

# Run linting
pnpm lint

# Run tests
pnpm test

# Run formatting
pnpm format

# Run lint-staged
pnpm lint-staged

echo "🏗️ בודק את הקוד לפני commit..."

# בדיקת טיפוסים
echo "📝 בודק טיפוסים..."
pnpm type-check || 
(
    echo "❌ בדיקת טיפוסים נכשלה. אנא תקן את השגיאות."
    false;
)

# בדיקת לינטינג מחמירה
echo "🔍 בודק לינטינג..."
pnpm lint:strict || 
(
    echo "❌ בדיקת לינטינג נכשלה. אנא תקן את השגיאות."
    false;
)

# בדיקת פורמט
echo "💅 בודק פורמט..."
pnpm format:check || 
(
    echo "❌ בדיקת פורמט נכשלה. אנא הרץ pnpm format לתיקון."
    false;
)

# בדיקות יחידה וכיסוי קוד
echo "🧪 מריץ בדיקות..."
pnpm test:coverage || 
(
    echo "❌ הבדיקות נכשלו או שכיסוי הקוד נמוך מהמינימום הנדרש."
    false;
)

# בדיקת קבצים בשלב
echo "📋 בודק קבצים בשלב..."
pnpm lint-staged || 
(
    echo "❌ בדיקת הקבצים בשלב נכשלה. אנא תקן את השגיאות."
    false;
)

# וולידציה סופית
echo "🔎 מבצע וולידציה סופית..."
pnpm validate || 
(
    echo "❌ הוולידציה נכשלה. אנא תקן את כל השגיאות לפני הדחיפה."
    false;
)

echo "✅ כל הבדיקות עברו בהצלחה! 🎉"
