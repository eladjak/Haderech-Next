# תכנית תיקון הפרויקט

מסמך זה מתעד את התכנית השלבית לתיקון הפרויקט ושיפור איכות הקוד. התכנית נוצרה ב-27.11.2023 ותעודכן באופן שוטף עם התקדמות העבודה.

## שלבי התכנית

### שלב 1: תיקון דירקטיבות "use client" ו-API ✅

**ברנץ'**: `fix/api-directives`  
**סטטוס**: הושלם ✓  
**יעד**: הסרת דירקטיבות מיותרות ועדכון קריאות createServerClient ל-createRouteHandlerClient  
**קבצים עיקריים**: `src/app/api/**/*.ts`  
**תיעוד**: `docs/api-client-directive-fixes.md`

**משימות:**

- [x] איתור קבצים בעייתיים
- [x] הסרת דירקטיבות "use client" מיותרות
- [x] החלפת createServerClient ב-createRouteHandlerClient
- [x] יצירת תיעוד מקיף
- [x] דחיפה והעלאה לייצור

### שלב 2: הוספת סקריפטי בדיקה ⏳

**ברנץ'**: `feature/build-check-tools`  
**סטטוס**: בביצוע  
**יעד**: הוספת כלים לוידוא איכות קוד ולמניעת בעיות דומות בעתיד  
**קבצים עיקריים**:

- `scripts/build-checks.js`
- `scripts/monitor-build.js`
- `scripts/check-api-directives.js`
- `.husky/pre-push`
- `docs/build-issues-fixes.md`

**משימות:**

- [x] יצירת סקריפט בדיקת API דירקטיבות
- [x] יצירת סקריפט בדיקת בילד
- [x] שיפור סקריפט בדיקת API דירקטיבות
- [x] יצירת סקריפט ניטור בילד
- [x] הוספת הוק pre-push עם אפשרויות מעקף
- [x] שיפור מצב soft לבדיקות
- [x] יצירת תיעוד שגיאות בילד נפוצות
- [ ] עדכון package.json להוספת הפקודות החדשות
- [ ] בדיקת ואימות הכלים

### שלב 3: תיקון שגיאות TypeScript בקבצי ליבה 🔜

**ברנץ'**: `fix/core-typescript-errors`  
**סטטוס**: מתוכנן  
**יעד**: תיקון שגיאות טיפוסים בקבצי הליבה ללא קבצי בדיקה  
**קבצים עיקריים**: קומפוננטות, שירותים ומודלים

**משימות:**

- [ ] עדכון tsconfig.json להחרגת קבצי בדיקה
- [ ] תיקון שגיאות בקומפוננטות
- [ ] תיקון שגיאות במודלים ושירותים
- [ ] וידוא שכל הפונקציונליות עובדת

### שלב 4: תיקון קבצי בדיקה 🔜

**ברנץ'**: `fix/tests`  
**סטטוס**: מתוכנן  
**יעד**: תיקון שגיאות בקבצי בדיקה  
**קבצים עיקריים**: `src/tests/**/*`

**משימות:**

- [ ] תיקון בדיקות יחידה
- [ ] תיקון בדיקות אינטגרציה
- [ ] תיקון בדיקות e2e
- [ ] וידוא שכל הבדיקות עוברות

## סיכום התקדמות

| שלב                  | סטטוס | הערות                                  |
| -------------------- | ----- | -------------------------------------- |
| 1. תיקון API         | 100%  | הושלם ודחוף לענף main                  |
| 2. סקריפטי בדיקה     | 75%   | רוב הכלים נוצרו, נדרשת השלמת אינטגרציה |
| 3. תיקון שגיאות ליבה | 0%    | טרם התחיל                              |
| 4. תיקון בדיקות      | 0%    | טרם התחיל                              |

---

## הערות חשובות

1. **בילד מהיר**: כדי להריץ בילד מהיר ללא בדיקות מחמירות:

   ```bash
   SKIP_TYPE_CHECK=1 pnpm build
   ```

2. **מעקף בדיקות git**: דרכים לעקוף את בדיקות ה-git hooks:

   ```bash
   # בהודעת commit
   git commit -m "תיקון עם עקיפת בדיקות [skip-checks]"

   # בדחיפה
   git push --no-verify

   # משתנה סביבה
   SKIP_GIT_HOOKS=1 git push
   ```

3. **פקודות שימושיות**:

   ```bash
   # בדיקת קבצי API ודירקטיבות
   pnpm run check-api

   # בדיקת קבצי API ודירקטיבות עם תיקון אוטומטי
   pnpm run fix-api-directives

   # בדיקת קומפוננטות לדירקטיבות שגויות
   pnpm run check-components

   # בדיקה מלאה לפני דחיפה
   pnpm run check-build

   # ניטור בילד עם לוג מפורט
   pnpm run monitor-build
   ```

4. **בעיות שזוהו בלוגים של Vercel**:

   - דירקטיבות "use client" בסוגריים
   - דירקטיבות "use client" אחרי ייבואים
   - שימוש בהוקים בקומפוננטות שרת ללא דירקטיבת "use client"

5. **עדכונים לבצע בהמשך**:
   - שדרוג לינטר להתריע על דירקטיבות במקום לא נכון
   - הוספת בדיקות אוטומטיות לטיפוסים
   - ארגון מחדש של הגדרות טיפוסים
   - הוספת סקריפט לתיקון אוטומטי של שגיאות TypeScript נפוצות
